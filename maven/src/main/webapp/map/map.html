<!DOCTYPE html>
<html style="margin:0;">

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>BaiduMap</title>
    <link rel="stylesheet" href="map.css">
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=cUVcaPVTlIznNo4BrEFsQmS8">
    //v2.0版本的引用方式：src="http://api.map.baidu.com/api?v=2.0&ak=您的密钥"//v1.4版本及以前版本的引用方式：src="http://api.map.baidu.com/api?v=1.4&key=您的密钥&callback=initialize"
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.1/jquery.min.js">
    </script>
    <script>
    window.jQuery || document.write('<script src="../js/vendor/jquery-2.2.1.min.js"><\/script>');
    </script>
    <script type="text/javascript" src="map.js"></script>
</head>

<body>
    <div id="ctrl_field">
        <div style="position:absolute;top:0;left:0;width:100%;height:150px;background:#000;color:#00FF24;">
            <div id="currentCoordinate"></div>
            <div id="console"></div>
        </div>
        <div id="inputSection">
            <table id="t_1" style="margin-top:150px;">
                <tr>
                    <td>
                        <label for=""><strong>根据纬经度显示位置</strong></label>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="">经度</label>
                        <input type="text" id="lng" placeholder="请输入经度" value="116.399">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="">纬度</label>
                        <input type="text" id="lat" placeholder="请输入纬度" value="39.910">
                    </td>
                </tr>
                <tr>
                    <td>
                        <button id="b_1">点我看看</button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button id="ipLocation">根据ip定位</button>
                    </td>
                </tr>
                <tr>
                    <td><strong>显示一组坐标的轨迹</strong></td>
                </tr>
                <tr id="coorsAfter">
                    <td>
                        <button id="addOneCoor">增加一个坐标</button>
                        <button id="showCoors">显示轨迹</button>
                        <button id="clearCoors">删除轨迹</button>
                    </td>
                </tr>
                <tr class="oneOfCoors">
                    <td>
                        <input type="text" placeholder="经度" class="lng" value="116.399">
                        <input type="text" placeholder="纬度" class="lat" value="39.910">
                        <button class="delOneCoor">删除</button>
                    </td>
                </tr>
                <tr class="oneOfCoors">
                    <td>
                        <input type="text" placeholder="经度" class="lng" value="116.405">
                        <input type="text" placeholder="纬度" class="lat" value="39.920">
                        <button class="delOneCoor">删除</button>
                    </td>
                </tr>
                <tr class="oneOfCoors">
                    <td>
                        <input type="text" placeholder="经度" class="lng" value="116.425">
                        <input type="text" placeholder="纬度" class="lat" value="39.900">
                        <button class="delOneCoor">删除</button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button id="showCarsByCoordinates">显示一组车</button>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button id="showTrack">显示一条轨迹</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="map_field" style="float:left;position:relative; width:100%; height:100%;">
        <div id="code_close" style="display: block;"></div>
        <div id="container" style="width:100%;height:100%">
        </div>
    </div>
    <script type="text/javascript">
    $(document).ready(function() {
        /**
         * 控制区域收起或打开
         * @return {[type]} [description]
         */
        (function ctrlConsole() {
            var speed = 200;
            $("#code_close").click(function(event) {
                if ($("#ctrl_field").css('width') != '0px') {
                    $(this).css({
                        'background': 'url(../img/result.png) no-repeat 0 -242px',
                    });
                    // 左边控制台栏收起
                    $("#ctrl_field").animate({
                            'width': '0'
                        },
                        speed,
                        function() {});
                    $("#map_field").animate({
                            'width': '100%'
                        },
                        'slow',
                        function() {});

                } else {
                    $(this).css({
                        'background': 'url(../img/result.png) no-repeat 0 -142px',
                    });
                    $("#ctrl_field").animate({
                            'width': '28%'
                        },
                        speed,
                        function() {});
                    $("#map_field").animate({
                            'width': '72%'
                        },
                        speed,
                        function() {});
                }
            });
        })();
        // $("#code_close").click();
        //////////////////////////////////////////功能测试///////////////////////////////////////////////////////////
        //测试初始化地图
        var map = initBMap();

        //测试显示坐标点
        $("#b_1").click(function(event) {
            var lng = $("#lng").val();
            var lat = $("#lat").val();
            if (lng && lat) {
                var coor = pos(lng, lat);
                removeOverlay(map);
                showPosByCoordinate(map, coor);
                map.panTo(pos(lng, lat)); //panTo()方法将让地图平滑移动至新中心点，如果移动距离超过了当前地图区域大小，则地图会直跳到该点
            }

        });

        //测试根据ip显示位置
        $("#ipLocation").click(function(event) {
            showPosByIp(map);
        });

        //接受用户输入坐标组
        $("#addOneCoor").click(function(event) {
            var oneCoorField = '<tr class="oneOfCoors"><td><input type="text" placeholder="经度" class="lng" /> <input type="text"placeholder="纬度" class="lat" /> <button class="delOneCoor">删除</button></td></tr>';
            $("tr.oneOfCoors:last").after(oneCoorField);
            $(".delOneCoor").each(function(index, el) {
                $(this).click(function(event) {
                    $(this).parents(".oneOfCoors").remove();
                });
            });
        });
        //测试显示一组坐标轨迹
        $("#showCoors").click(function(event) {
            var pointArr = new Array();
            $(".oneOfCoors").each(function(index, el) {
                var lng = $(this).find('.lng').val();
                var lat = $(this).find('.lat').val();
                if (lng <= 0 && lat <= 0)
                    return;
                var point = pos(lng, lat);
                pointArr.push(point);
            });
            showPathByCoordinates(map, pointArr);
        });
        //测试清除一组坐标轨迹
        $("#clearCoors").click(function(event) {
            removeOverlay(map);
        });

        //测试显示一组车
        $("#showCarsByCoordinates").click(function(event) {
            var mapPoints = [];
            var o1 = new BMap.Point(116.399, 39.910);
            var o2 = new BMap.Point(116.405, 39.920);
            var o3 = new BMap.Point(116.425, 39.900);

            mapPoints.push(o1);
            mapPoints.push(o2);
            mapPoints.push(o3);
            showCarsByCoordinates(map, mapPoints);
        });
        //测试显示一条轨迹
        $("#showTrack").click(function(event) {
            var o1 = new BMap.Point(116.399, 39.910);
            var o2 = new BMap.Point(116.405, 39.920);
            var o3 = new BMap.Point(116.425, 39.900);
            var mapPoints = [];
            mapPoints.push(o1);
            mapPoints.push(o2);
            mapPoints.push(o3);

            showTrack(map, mapPoints);
        });


        //////////////////////////////////////////end功能测试end///////////////////////////////////////////////////////////

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        var domStr = '<input type="text" id="pageListener_map" style="width:0;padding:0;margin:0;border:0;" value="">';
        $("body").append(domStr);
        var AllGlobal = window.top.AllGlobal;
        if (AllGlobal != null && AllGlobal != undefined) {
            var mapPageCheckHelper = $("#pageListener_map");
            mapPageCheckHelper.change(function(event) {
                var pointArr = AllGlobal.getPointArr();
                var mapPoints = [];
                for (var i = 0; i < pointArr.length; i++) {
                    var o = new BMap.Point(pointArr[i].longtitude,pointArr[i].latitude);
                    mapPoints.push(o)
                }

                showCarsByCoordinates(map, mapPoints);
            });
            AllGlobal.setMapPageCheckHelper(mapPageCheckHelper);
            AllGlobal.resolve();
        } else {
            console.log("mediator undefined");
        }
    });
    </script>
</body>

</html>
