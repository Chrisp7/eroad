<!DOCTYPE html>
<html style="margin:0;height:100%;">

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>运单</title>
    <link rel="stylesheet" href="style/columnal.css">
    <link rel="stylesheet" href="style/font_css/font-awesome.min.css">
    <link rel="stylesheet" href="style/reset.css">
    <script type="text/javascript" src="js/vendor/jquery-2.2.1.min.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
    <script>
    //没网则从本地加载
    window.Modernizr || document.write('<script src="js/vendor/modernizr-2.6.2.min.js"><\/script>');
    window.jQuery || document.write('<script src="js/vendor/jquery-2.2.1.min.js"><\/script>');
    </script>
    <script type="text/javascript" src="js/init.js"></script>
    <style type="text/css">
    * {
        overflow: hidden;
    }
    
    .container,
    .row {
        width: 100%;
        height: 100%;
        max-width: 100%;
        margin: 0;
        padding: 0;
        border: 0;
    }
    /*左边运单列表*/
    
    .title {
        width: 98%;
        /*background: #E41819;*/
        background: #424242;
        color: #767676;
        font-size: 1.5rem;
        text-align: center;
        border-bottom: 1px solid #eee;
    }
    
    .title label {
        line-height: 2;
    }
    
    input[name="radio_yd_type"] {
        background
    }
    
    .active {
        height: 91%;
        overflow-y: scroll;
    }
    
    .ele {
        border-bottom: 1px solid #eee;
        border-right: 1px solid #eee;
    }
    
    .ele:hover {
        background: #000;
        color: #fff;
    }
    
    .line {
        text-align: center;
        line-height: 1.5;
    }
    /*列表动画*/
    
    .ele {
        position: relative;
        opacity: 0;
        top: 0;
    }
    
    @keyframes ele-show {
        0% {
            opacity: 0;
            top: 200px;
        }
        100% {
            opacity: 1;
            top: 0;
        }
    }
    
    .active .ele {
        animation: ele-show .8s linear forwards;
    }
    
    .active .ele1 {
        animation-delay: .4s;
    }
    
    .active .ele2 {
        animation-delay: .8s;
    }
    /*右边地图*/
    
    .left {
        height: 100%;
    }
    
    .right {
        overflow: hidden;
    }
    
    .left_toggle {
        display: none;
    }
    /*iphone 5s 竖屏*/
    
    @media screen and (max-device-width:320px) and (orientation:portrait) {
        /*地图全屏*/
        .row {
            position: relative;
        }
        .left_toggle {
            display: block;
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20px;
            text-align: center;
            background: #DBDFE5;
        }
        .left.col_3 {
            width: 100%;
            height: 0;
            padding-top: 0;
            position: absolute;
            bottom: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, .7);
        }
        .left.col_3 .line {
            color: #fff;
        }
        .right.col_9 {
            width: 100%;
        }
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="left col_3 noRmargin">
                <div class="title">
                    <label for="r_1">
                        <input id="r_1" type="radio" value="1" name="radio_yd_type" checked hidden>运单</label>
                    <label for="r_2">
                        <input id="r_2" type="radio" value="2" name="radio_yd_type" hidden>发布中订单</label>
                    <label for="r_3">
                        <input id="r_3" type="radio" value="3" name="radio_yd_type" hidden>历史订单</label>
                </div>
                <ul class="col_12 active">
                    <li class="col_12 ele">
                        <div class="line">car_number："苏E12345"</div>
                        <div class="line">username："aaa"</div>
                        <div class="line">phone_number："11111111111"</div>
                        <div class="line">sketch："猪"</div>
                        <div class="line">
                            <div class="float_left">start_address</div>
                            ————→
                            <div class="float_right">destination</div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="right col_9 omega height_100">
                <iframe id="iframe_map" src="map/ydMap.html" style="width:100%;height:100%;"></iframe>
            </div>
            <div class="left_toggle">
                <i class="icon-chevron-up"></i>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    $(document).ready(function() {
        var isMobile = false;
        Modernizr.load({
            test: Modernizr.mq('only screen and (max-device-width:320px) and (orientation:portrait)'),
            yep: 'js/l_yd.js',
            callback: function() {
                isMobile = true;
            }
        });

        var AllGlobal = window.top.AllGlobal;


        $("input:radio[name=radio_yd_type]").change(function(event) {
            $("input:radio[name=radio_yd_type]").parent().css('color', '#767676');
            $("input:radio[name=radio_yd_type]:checked").parent().css('color', '#fff');
            var yd_type = $("input:radio[name=radio_yd_type]:checked").val();

            if (AllGlobal != null && AllGlobal != undefined) {
                if (yd_type === "1") {
                    // 获取正在运行的订单信息列表
                    var prefix = AllGlobal.getPrefix();
                    var url = prefix + 'company/get_executing_order.erd';
                    var o = {};
                    o.id = AllGlobal.getUserInfo().id;

                    ajaxPost(url, o, function(data, textStatus, xhr) {
                        var domStr = "";
                        if (data[0].status === "ok") {
                            for (var i = 1; i < data.length; i++) {
                                domStr += '<li class="col_12 ele ele' + i + '">';
                                domStr += '    <div class="display_none">' + data[i].id + '</div>';
                                domStr += '    <div class="line">司机：' + data[i].username + '</div>';
                                domStr += '    <div class="line">车辆牌照：' + data[i].car_number + '</div>';
                                domStr += '    <div class="line">手机：' + data[i].phone_number + '</div>';
                                domStr += '    <div class="line">货物：' + data[i].sketch + '</div>';
                                domStr += '    <div class="line">';
                                domStr += '        <div class="float_left">' + data[i].start_address + '</div>';
                                domStr += '        ————→';
                                domStr += '        <div class="float_right">' + data[i].destination + '</div>';
                                domStr += '    </div>';
                                domStr += '</li>';
                            }
                            $("ul.active").html(domStr);
                            $("ul.active li").click(function(event) {
                                if (isMobile) {
                                    $(".left_toggle").click();
                                }
                                var crtOderId = $(this).children('.display_none').html();
                                $("#iframe_map").attr('src', 'map/ydMap.html?id=' + crtOderId);
                            });
                        } else {
                            console.log(data[0]);
                        }
                    });
                } else if (yd_type === "2") {
                    // 获取发布中的订单信息列表
                    var prefix = AllGlobal.getPrefix();
                    var url = prefix + 'company/get_bidding_order_list.erd';
                    var o = {};
                    o.id = AllGlobal.getUserInfo().id;

                    ajaxPost(url, o, function(data, textStatus, xhr) {
                        console.log(data);
                        // var domStr = "";
                        // if (data[0].status === "ok") {
                        //     for (var i = 1; i < data.length; i++) {
                        //         domStr += '<li class="col_12 ele ele' + i + '">';
                        //         domStr += '    <div class="display_none">' + data[i].id + '</div>';
                        //         domStr += '    <div class="line">司机：' + data[i].username + '</div>';
                        //         domStr += '    <div class="line">车辆牌照：' + data[i].car_number + '</div>';
                        //         domStr += '    <div class="line">手机：' + data[i].phone_number + '</div>';
                        //         domStr += '    <div class="line">货物：' + data[i].sketch + '</div>';
                        //         domStr += '    <div class="line">';
                        //         domStr += '        <div class="float_left">' + data[i].start_address + '</div>';
                        //         domStr += '        ————→';
                        //         domStr += '        <div class="float_right">' + data[i].destination + '</div>';
                        //         domStr += '    </div>';
                        //         domStr += '</li>';
                        //     }
                        //     $("ul.active").html(domStr);
                        //     $("ul.active li").click(function(event) {
                        //         var crtOderId = $(this).children('.display_none').html();
                        //         $("#iframe_map").attr('src', 'map/ydMap.html?id=' + crtOderId);
                        //     });
                        // } else {
                        //     console.log(data[0]);
                        // }
                    });
                } else if (yd_type === "3") {
                    // 获取历史订单信息列表
                    var prefix = AllGlobal.getPrefix();
                    var url = prefix + 'company/get_history_order_list.erd';
                    var o = {};
                    o.id = AllGlobal.getUserInfo().id;

                    ajaxPost(url, o, function(data, textStatus, xhr) {
                        console.log(data);
                        var domStr = "";
                        if (data[0].status === "ok") {
                            for (var i = 1; i < data.length; i++) {
                                domStr += '<li class="col_12 ele ele' + i + '">';
                                domStr += '    <div class="display_none">' + data[i].order_number + '</div>';
                                domStr += '    <div class="line">司机：' + data[i].username + '</div>';
                                domStr += '    <div class="line">成交价：' + data[i].exact_fare + '</div>';
                                domStr += '    <div class="line">持续时间：' + data[i].last_time + '天</div>';
                                domStr += '    <div class="line">货物：' + data[i].sketch + '</div>';
                                domStr += '    <div class="line">';
                                domStr += '        <div class="float_left">' + data[i].start_address + '</div>';
                                domStr += '        ————→';
                                domStr += '        <div class="float_right">' + data[i].destination + '</div>';
                                domStr += '    </div>';
                                domStr += '</li>';
                            }
                            $("ul.active").html(domStr);
                            $("ul.active li").click(function(event) {
                                if (isMobile) {
                                    $(".left_toggle").click();
                                }
                                var crtOderId = $(this).children('.display_none').html();
                                $("#iframe_map").attr('src', 'map/ydMap.html?id=' + crtOderId);
                            });
                        } else {
                            console.log("history order fail -> " + data[0]);
                        }
                    });
                }
            } else {
                console.log("mediator undefined");
            }

        });
        $("input:radio[name=radio_yd_type]").change();




        /*移动端*/
        $(".left_toggle").off("click").click(function(event) {
            var operator = '+';
            if (!$(".left_toggle i").hasClass('icon-chevron-up')) {
                operator = '-';
            }
            $(".left_toggle i").toggleClass('icon-chevron-up');
            $(".left_toggle i").toggleClass('icon-chevron-down');
            $(this).animate({
                    bottom: operator + '=80%'
                },
                500);
            $(".left").animate({
                    // right: operator + '=100px',
                    height: operator + '=80%',
                    opacity: operator + '=1'
                },
                500);
        });
    });
    </script>
</body>

</html>
